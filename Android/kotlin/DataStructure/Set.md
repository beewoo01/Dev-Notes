# Kotlin에서의 Set 완전 정복

현재 나는 필리핀 보홀 여행중이다.
남은 여가시간에 JetNews 프로젝트 코드를 살펴보며 학습하고 있다.<br/>
소스코드 하나하나 이해를 해보며 학습하려고 했는데 Set을 확장함수로 두고 작성한 코드를 보며 의문이 들었다. 
```kotlin
internal fun <E> Set<E>.addOrRemove(element: E): Set<E> {
    return this.toMutableSet().apply {
        if (!add(element)) {
            remove(element)
        }
    }.toSet()
}

```
(위 코드는 Set 객체를 받아서 변환 가능한 mutableSet으로 변환해 
내용이 있으면 삭제, 없으면 추가해서 Set으로 다시 변환해 반환하는 함수이다.)

```
* 참고
Set의 add()는 Boolean을 반환하며, 이미 동일한 객체가 존재하면
추가하지 않고 false를 반환한다. 존재하지 않는 경우에만 추가된다.
```

분명 Set에 대해 알고있는데,
의문이 들었다. 언제가 불변이고 가변이지?



아래는 내가 이해한 내용을 AI 도움을 받아 정리했다.


## ✅ Kotlin의 Set 계열 요약

| 생성 방법                 | 타입           | 불변성     | 설명 |
|--------------------------|----------------|------------|------|
| `setOf(...)`             | `Set`          | ✅ 진짜 불변 | 완전 불변. 요소 추가/삭제 불가 |
| `mutableSetOf(...)`      | `MutableSet`   | ✅ 가변     | 요소 추가/삭제 가능 |
| `val s: Set = ...`       | `Set` (인터페이스) | ❓ 구현체 따라 다름 | 읽기 전용이지만 실제로는 가변일 수 있음 |
| `HashSet(...)`           | ❌ 자바 타입    | ❌ Kotlin 기본 아님 | Kotlin에서는 거의 직접 사용하지 않음 |

---

## ✅ 기본 개념

- `Set` : **읽기 전용 인터페이스** (요소 추가/삭제 불가)  
- `MutableSet` : **가변 인터페이스** (요소 추가/삭제 가능)  
- `setOf(...)` : **불변 구현체 생성 함수**  
- `mutableSetOf(...)` : **가변 구현체 생성 함수**

---

## ✅ 진짜 불변 vs 가변

| 선언                          | 실제 불변성     | 설명 |
|------------------------------|----------------|------|
| `val s = setOf("a", "b")`     | ✅ 진짜 불변     | 안전하게 요소 변경 불가 |
| `val s = mutableSetOf("a")`   | ✅ 가변          | 요소 추가/삭제 가능 |
| `val s: Set = mutableSetOf()` | ❌ 가변일 수 있음 | 타입만 읽기 전용, 내부는 가변일 수도 있음 |

> `Set` 타입은 단지 "읽기 전용 인터페이스"일 뿐이고, 실제 객체가 불변인지 여부는 **구현체**를 봐야 한다.

---

## ✅ 외부엔 읽기 전용으로, 내부에선 가변으로 사용

```kotlin
private val _favorites = mutableSetOf("1", "2")
val favorites: Set<String> get() = _favorites
```

- 외부에는 Set으로 제공 → 읽기 전용처럼 보임
- 내부에서는 자유롭게 수정 가능 → **MutableSet**
- 읽기 전용 인터페이스만 노출하면 외부에서 `add()`, `remove()` 호출 불가
- 안전한 상태 관리 및 캡술화에 적합한 패턴

## ✅ 기억할 핵심 요약

| 이름             | 인터페이스   | 가변 여부         | 실제 용도                          |
|------------------|--------------|-------------------|-----------------------------------|
| `Set`            | 읽기 전용    | ❓ 구현체 따라 다름 | 외부 노출용, 불변처럼 사용         |
| `MutableSet`     | 가변         | ✅ 항상 가변       | 내부에서 수정 가능                 |
| `setOf()`        | `Set`        | ❌ 변경 불가       | 안전한 진짜 불변 컬렉션 생성       |
| `mutableSetOf()` | `MutableSet` | ✅ 변경 가능       | 요소 추가/삭제 가능한 Set 생성    |

---

## ✅ 결론

- `Set`은 **인터페이스일 뿐이며**, 실제 객체가 진짜 불변인지 여부는 **구현체**에 따라 다르다.
- 진짜 불변을 원한다면 `setOf()`를 사용하면된다.
- `MutableSet`은 언제나 가변이고, `mutableSetOf()`는 그의 기본 구현이다.



